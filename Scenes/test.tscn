[gd_scene load_steps=8 format=3 uid="uid://bgnpsxd7a2c34"]

[ext_resource type="Texture2D" uid="uid://bd1h5px3043u3" path="res://Assets/mantle.png" id="1_c1y5o"]
[ext_resource type="Texture2D" uid="uid://bsewdw47nb2w1" path="res://Assets/player_R.png" id="2_xusyu"]

[sub_resource type="CircleShape2D" id="CircleShape2D_oqrp7"]
radius = 998.221

[sub_resource type="GDScript" id="GDScript_642i8"]
resource_name = "wtf"
script/source = "extends CharacterBody2D

@export var gravityCenter: StaticBody2D

const SPEED = 300.0
const JUMP_VELOCITY = -400.0
#const GROUND_FRICTION := 12.0

# Get the gravity from the project settings to be synced with RigidBody nodes.
var gravity = ProjectSettings.get_setting(\"physics/2d/default_gravity\")


func _physics_process(delta):
	# Add the gravity.
	if not is_on_floor():
		velocity.y += gravity * delta
#		velocity = move_toward(position, gravityCenter, gravity)

	# Handle Jump.
	if Input.is_action_just_pressed(\"jump\") and is_on_floor():
		velocity.y = JUMP_VELOCITY

	# Get the input direction and handle the movement/deceleration.
	# As good practice, you should replace UI actions with custom gameplay actions.
	var direction = Input.get_axis(\"left\", \"right\")
	if direction:
		velocity.x = direction * SPEED
	else:
		velocity.x = move_toward(velocity.x, 0, SPEED)

	move_and_slide()
"

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_j3dxn"]
radius = 36.0
height = 128.0

[sub_resource type="GDScript" id="GDScript_u263s"]
resource_name = "wtf2"
script/source = "extends RigidBody2D

@export var currentplanet : StaticBody2D

@onready var animated_sprite_2d = $PlayerR
@onready var ray_cast_2d = $RayCast2D

const MOVE_SPEED = 20
const JUMP_FORCE = -500

func _physics_process(delta):
	var direction = Input.get_axis(\"left\", \"right\")
	var planetDirection = global_position.direction_to(currentplanet.global_position)
	var force = Vector2.ZERO
	
	if _on_floor() and Input.is_action_just_pressed(\"jump\"):
		apply_central_impulse(planetDirection * JUMP_FORCE)
	
	if direction:
		force += planetDirection.orthogonal() * MOVE_SPEED * direction 
	
	apply_central_impulse(force)
	
	look_at(currentplanet.global_position)

func _on_floor():
	if ray_cast_2d.is_colliding(): return true
	
func _integrate_forces(state):
	rotation_degrees = 0
	
#func _input(event):
#	# Animação L+R
#	if Input.is_action_pressed(\"left\"):
#		scale.x = -1
##		sprite.flip_h = true
#	elif Input.is_action_pressed(\"right\"):
#		scale.x = 1
##		sprite.flip_h = false
	
func _set_animation(direction):
	if direction > 0: animated_sprite_2d.flip_h = false
	elif direction < 0: animated_sprite_2d.flip_h = true
	
#	if abs(linear_velocity.x) > 0.1: animated_sprite_2d.play(\"walk\")
#	else: animated_sprite_2d.play(\"RESET\")
"

[sub_resource type="CircleShape2D" id="CircleShape2D_p4umh"]
radius = 2116.13

[node name="Asteroid" type="StaticBody2D"]

[node name="Mantle" type="Sprite2D" parent="."]
texture = ExtResource("1_c1y5o")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("CircleShape2D_oqrp7")

[node name="CharacterBody2D" type="CharacterBody2D" parent="." node_paths=PackedStringArray("gravityCenter")]
position = Vector2(-2082, -978)
script = SubResource("GDScript_642i8")
gravityCenter = NodePath("..")

[node name="PlayerR" type="Sprite2D" parent="CharacterBody2D"]
texture = ExtResource("2_xusyu")

[node name="CollisionShape2D" type="CollisionShape2D" parent="CharacterBody2D"]
shape = SubResource("CapsuleShape2D_j3dxn")

[node name="CharacterBody2D2" type="RigidBody2D" parent="." node_paths=PackedStringArray("currentplanet")]
position = Vector2(0, -1000)
linear_damp = 3.0
script = SubResource("GDScript_u263s")
currentplanet = NodePath("..")

[node name="PlayerR" type="Sprite2D" parent="CharacterBody2D2"]
rotation = -1.5708
texture = ExtResource("2_xusyu")

[node name="CollisionShape2D" type="CollisionShape2D" parent="CharacterBody2D2"]
rotation = -1.5708
shape = SubResource("CapsuleShape2D_j3dxn")

[node name="RayCast2D" type="RayCast2D" parent="CharacterBody2D2"]
position = Vector2(63, 0)
rotation = -1.5708
target_position = Vector2(0, 20)

[node name="Camera2D" type="Camera2D" parent="CharacterBody2D2"]
rotation = -1.5708
ignore_rotation = false
zoom = Vector2(0.5, 0.5)
position_smoothing_enabled = true
position_smoothing_speed = 20.0
rotation_smoothing_enabled = true

[node name="Area2D" type="Area2D" parent="."]
gravity_space_override = 3
gravity_point = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D"]
shape = SubResource("CircleShape2D_p4umh")
